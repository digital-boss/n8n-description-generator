{
  "version": 3,
  "sources": ["../../../../src/usecases/res-op/transformers/param.ts"],
  "sourcesContent": ["import { NodePropertyTypes } from 'n8n-workflow';\nimport { ConditionFn, propSetter, TransformerFn } from 'src/transform';\nimport { TypeName } from '../types';\nimport { TraverseContext } from 'src/TraverseContext';\n\n\n/******************************************************************************\n * Utilities\n */\n\ninterface ISrc {\n\tmodels:Record<string, Array<{name?: string}>>;\n}\n\nexport const getModelField = <T>(name: string, ctx: TraverseContext<T,ISrc>): object | undefined => {\n\tconst [modelName, fieldName] = name.split('.');\n\tconst model = ctx.sourceObj.models[modelName];\n\treturn model.find(f => f.name === fieldName);\n};\n\nexport const getDefaultForType = (type?: NodePropertyTypes): any => {\n\tswitch (type) {\n\t\tcase 'boolean':\n\t\t\treturn false;\n\t\tcase 'collection':\n\t\t\treturn [];\n\t\tcase 'dateTime':\n\t\t\treturn '';\n\t\tcase 'fixedCollection':\n\t\t\treturn {};\n\t\tcase 'number':\n\t\t\treturn 0;\n\t\tcase 'string':\n\t\t\treturn '';\n\t\tcase 'options':\n\t\t\treturn '';\n\t\t// Not implemented:\n\t\t// case 'color':\n\t\t// \treturn\n\t\t// case 'hidden':\n\t\t// \treturn\n\t\t// case 'json':\n\t\t// \treturn\n\t\t// case 'notice':\n\t\t// \treturn\n\t\t// case 'multiOptions':\n\t\t// \treturn\n\n\t\t// case 'credentialsSelect':\n\t\t// \treturn\n\t\tdefault:\n\t\t\tthrow new Error(`Not implemented default for type: ${type}`);\n\t}\n};\n\n/**\n * @returns hierarchy: Resource, operation, param...\n */\nexport const getHighHierarchy = (ctx: TraverseContext<TypeName, ISrc>): string[] => {\n\tconst result: string[] = [];\n\n\tlet end = ctx.path.length;\n\twhile (end > 0) {\n\t\tconst s = ctx.getData(end);\n\t\tif (s) {\n\t\t\tconst o = ctx.getValue(end);\n\t\t\tif (s.type === 'Param') {\n\t\t\t\tresult.push(o.name);\n\t\t\t} else if (s.type === 'Operation') {\n\t\t\t\tconst op = ctx.path[end-1] as string;\n\t\t\t\tresult.push(op);\n\t\t\t} else if (s.type === 'Resource') {\n\t\t\t\tconst resName = ctx.path[end-1] as string;\n\t\t\t\tresult.push(resName);\n\t\t\t}\n\t\t}\n\t\tend--;\n\t}\n\treturn result.reverse();\n};\n\n\nexport const getRequired = (v: any, ctx: TraverseContext<TypeName, ISrc>): boolean | undefined => {\n\tconst s = ctx.getData(-2);\n\tif (s && s.type === 'Operation' && !['collection', 'fixedCollection'].includes(v.type)) {\n\t\treturn true;\n\t}\n\treturn undefined;\n};\n\n\n/******************************************************************************\n * Conditions and Transformers\n */\n\nexport const isLink: ConditionFn = (v, ctx) => v !== null && typeof v === 'object' && '$link' in v;\n\nexport const importFromModel: TransformerFn<TypeName,ISrc> = (v: string, ctx) => {\n\tconst field = getModelField(v, ctx);\n\treturn field;\n};\n\nexport const linkFromModel: TransformerFn<TypeName, ISrc> = (v, ctx) => {\n\tconst field = getModelField(v.$link, ctx);\n\tconst result = {\n\t\t...field,\n\t\t...v,\n\t};\n\tdelete result.$link;\n\treturn result;\n};\n\nexport const setType: TransformerFn<TypeName, ISrc> = propSetter('type', () => 'string');\nexport const setDefault: TransformerFn<TypeName, ISrc> = propSetter('default', (v, _) => getDefaultForType(v.type));\nexport const setRequired: TransformerFn<TypeName, ISrc> = propSetter('required', (v, ctx) => getRequired(v, ctx));\n\nexport const setDisplayOptions: TransformerFn<TypeName, ISrc> = (v, ctx) => {\n\tconst hier = getHighHierarchy(ctx);\n\n\tif (hier.length !== 3) {\n\t\treturn v;\n\t}\n\tconst [res, op] = hier;\n\treturn {\n\t\t...v,\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\tresource: [res],\n\t\t\t\toperation: [op],\n\t\t\t},\n\t\t},\n\t};\n};\n\n"],
  "mappings": "+CAcO,GAAM,GAAgB,CAAI,EAAc,IAAqD,CACnG,GAAM,CAAC,EAAW,GAAa,EAAK,MAAM,GAAG,EAE7C,MAAO,AADO,GAAI,UAAU,OAAO,GACtB,KAAK,GAAK,EAAE,OAAS,CAAS,CAC5C,EAEa,EAAoB,AAAC,GAAkC,CACnE,OAAQ,OACF,UACJ,MAAO,OACH,aACJ,MAAO,CAAC,MACJ,WACJ,MAAO,OACH,kBACJ,MAAO,CAAC,MACJ,SACJ,MAAO,OACH,SACJ,MAAO,OACH,UACJ,MAAO,WAgBP,KAAM,IAAI,OAAM,qCAAqC,GAAM,EAE9D,EAKa,EAAmB,AAAC,GAAmD,CACnF,GAAM,GAAmB,CAAC,EAEtB,EAAM,EAAI,KAAK,OACnB,KAAO,EAAM,GAAG,CACf,GAAM,GAAI,EAAI,QAAQ,CAAG,EACzB,GAAI,EAAG,CACN,GAAM,GAAI,EAAI,SAAS,CAAG,EAC1B,GAAI,EAAE,OAAS,QACd,EAAO,KAAK,EAAE,IAAI,UACR,EAAE,OAAS,YAAa,CAClC,GAAM,GAAK,EAAI,KAAK,EAAI,GACxB,EAAO,KAAK,CAAE,CACf,SAAW,EAAE,OAAS,WAAY,CACjC,GAAM,GAAU,EAAI,KAAK,EAAI,GAC7B,EAAO,KAAK,CAAO,CACpB,CACD,CACA,GACD,CACA,MAAO,GAAO,QAAQ,CACvB,EAGa,EAAc,CAAC,EAAQ,IAA8D,CACjG,GAAM,GAAI,EAAI,QAAQ,EAAE,EACxB,GAAI,GAAK,EAAE,OAAS,aAAe,CAAC,CAAC,aAAc,iBAAiB,EAAE,SAAS,EAAE,IAAI,EACpF,MAAO,EAGT,EAOa,EAAsB,CAAC,EAAG,IAAQ,IAAM,MAAQ,MAAO,IAAM,UAAY,SAAW,GAEpF,EAAgD,CAAC,EAAW,IAC1D,EAAc,EAAG,CAAG,EAItB,EAA+C,CAAC,EAAG,IAAQ,CAEvE,GAAM,GAAS,CACd,GAFa,EAAc,EAAE,MAAO,CAAG,EAGvC,GAAG,CACJ,EACA,aAAO,GAAO,MACP,CACR,EAEa,EAAyC,EAAW,OAAQ,IAAM,QAAQ,EAC1E,EAA4C,EAAW,UAAW,CAAC,EAAG,IAAM,EAAkB,EAAE,IAAI,CAAC,EACrG,EAA6C,EAAW,WAAY,CAAC,EAAG,IAAQ,EAAY,EAAG,CAAG,CAAC,EAEnG,EAAmD,CAAC,EAAG,IAAQ,CAC3E,GAAM,GAAO,EAAiB,CAAG,EAEjC,GAAI,EAAK,SAAW,EACnB,MAAO,GAER,GAAM,CAAC,EAAK,GAAM,EAClB,MAAO,CACN,GAAG,EACH,eAAgB,CACf,KAAM,CACL,SAAU,CAAC,CAAG,EACd,UAAW,CAAC,CAAE,CACf,CACD,CACD,CACD",
  "names": []
}
